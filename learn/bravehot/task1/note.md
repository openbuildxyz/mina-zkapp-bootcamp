
## Layer2
Layer1 通常面临吞吐量有限，高交易费用，交易确认时间较长等缺点.

Layer2 将大部分的交易逻辑转移到链下执行，并把多个交易打包成一个交易，提交到主链，通过一次性验证多笔交易，从而增加网络效率，以减少链上交易量

Layer2 分为两类，侧链实现 和 Rollup，Rollup 又分为 zkRollup 和 Optimistic Rollup。

### Optimistic Rollup（乐观型 Rollup）
乐观的假设提交到主链的交易默认被认为是正确的，不需要立即验证，采用欺诈证明机制（Fraud Proof），允许任何验证者对无效交易提出挑战。

Optimism 和 Arbitrum 都属于 乐观型 Rollup


#### 欺诈证明机制
* 提交交易的验证者（Sequencer 或 Proposer）需要提交一笔保证金。如果其提交的状态被证明有误，这笔保证金会被罚没，转给挑战者。
* 如果挑战成功，挑战者会获得提交者的保证金作为奖励，并补偿挑战者的 Gas 费用
* 为了防止恶意或滥用挑战行为，挑战者也需要提交一笔保证金，如果挑战者发起欺诈证明但未能证明状态错误，挑战者需要支付提交欺诈证明的 Gas 费用

这设计形成了双向经济激励，既防止提交者作恶，又避免挑战者发起无效挑战。

#### 链下执行，链上验证
Rollup 在链下执行交易后，生成一个全局的链下状态（包括账户余额、智能合约状态等）。
这个状态以 Merkle 树的形式组织，其根哈希（Merkle Root）是状态的唯一标识，作为状态更新的证明提交到主链
目前，大多数 Optimistic Rollup 项目的链下数据仍然以 中心化存储 为主，但这种方式存在信任和单点故障风险。

Merkle 根哈希是链下状态的加密摘要。只需存储根哈希，任何验证者都可以用链下的交易记录和账户状态进行重建和验证。

如果有争议，验证者可以根据主链上的提交数据和链下的详细交易数据发起欺诈证明。

Optimism 的设计核心目标是 数据可用性优先，通过提交完整的交易数据，任何人都可以从主链获取这些数据，无需依赖链下存储节点，用户无需担心 Rollup 提交者或链下节点的行为是否可信，这种模式更加接近完全去信任化的理想。但提交所有交易数据增加了 Gas 消耗，尤其是在以太坊主链存储时，成本问题更加明显。这使得 Optimism 的交易费用通常高于 Arbitrum。

Arbitrum 尽量减少提交到主链的数据，通常只提交状态根（State Root）和批次摘要，完整的交易数据和计算过程由链下节点维护，在出现争议时，链下节点必须提供所有相关的详细数据，验证状态的正确性。


### ZkRollup
zkRollup 提交到主链的数据与 Optimistic Rollup 不同，其核心在于利用零知识证明（ZKP）机制，以更高效和信任最小化的方式验证链下状态。

zkRollup 提交到主链的主要数据是 状态根哈希 和 零知识证明，有些实现还会提交压缩的交易数据以满足数据可用性需求。

zkRollup 只需要验证零知识证明就可以验证交易是否有限，无需像 Optimistic Rollup 那样等待争议期，主链可以在几毫秒内验证零知识证明，大幅提高效率。并且链上存储成本较低，大大降低了链上存储成本。

#### 零知识证明
zkRollup 的关键是提交一个零知识有效性证明（通常是 zk-SNARK 或 zk-STARK 生成的证明）。

## 关于零知识证明
零知识证明是一种密码学技术，它指的是证明者能够在不向验证者提供任何有用信息的情况下，使验证者相信某个论断是正确的（例子： 魔法洞穴）。

零知识证明属于概率性证明，而非数学上的严谨证明，通过增加测试次数来减少错误概率，它可以通过设计将错误率降到非常低，且计算复杂性足够高，使得攻击代价不可承受。


 


